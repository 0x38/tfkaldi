<?xml version='1.0' encoding='UTF-8' standalone='no'?>
<doxygen xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="compound.xsd" version="1.8.5">
  <compounddef id="ark_8py" kind="file">
    <compoundname>ark.py</compoundname>
    <innerclass refid="classark_1_1ArkReader" prot="public">ark::ArkReader</innerclass>
    <innerclass refid="classark_1_1ArkWriter" prot="public">ark::ArkWriter</innerclass>
    <innernamespace refid="namespaceark">ark</innernamespace>
    <briefdescription>
    </briefdescription>
    <detaileddescription>
    </detaileddescription>
    <programlisting>
<codeline lineno="1"><highlight class="comment">#<sp/>Copyright<sp/>2014<sp/><sp/><sp/><sp/>Yajie<sp/>Miao<sp/><sp/><sp/><sp/>Carnegie<sp/>Mellon<sp/>University</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2"><highlight class="normal"></highlight><highlight class="comment">#<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>2015<sp/><sp/><sp/><sp/>Yun<sp/>Wang<sp/><sp/><sp/><sp/><sp/><sp/>Carnegie<sp/>Mellon<sp/>University</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="3"><highlight class="normal"></highlight></codeline>
<codeline lineno="4"><highlight class="normal"></highlight><highlight class="comment">#<sp/>Licensed<sp/>under<sp/>the<sp/>Apache<sp/>License,<sp/>Version<sp/>2.0<sp/>(the<sp/>&quot;License&quot;);</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="5"><highlight class="normal"></highlight><highlight class="comment">#<sp/>you<sp/>may<sp/>not<sp/>use<sp/>this<sp/>file<sp/>except<sp/>in<sp/>compliance<sp/>with<sp/>the<sp/>License.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="6"><highlight class="normal"></highlight><highlight class="comment">#<sp/>You<sp/>may<sp/>obtain<sp/>a<sp/>copy<sp/>of<sp/>the<sp/>License<sp/>at</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="7"><highlight class="normal"></highlight><highlight class="comment">#</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="8"><highlight class="normal"></highlight><highlight class="comment">#<sp/><sp/>http://www.apache.org/licenses/LICENSE-2.0</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="9"><highlight class="normal"></highlight><highlight class="comment">#</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="10"><highlight class="normal"></highlight><highlight class="comment">#<sp/>THIS<sp/>CODE<sp/>IS<sp/>PROVIDED<sp/>*AS<sp/>IS*<sp/>BASIS,<sp/>WITHOUT<sp/>WARRANTIES<sp/>OR<sp/>CONDITIONS<sp/>OF<sp/>ANY</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="11"><highlight class="normal"></highlight><highlight class="comment">#<sp/>KIND,<sp/>EITHER<sp/>EXPRESS<sp/>OR<sp/>IMPLIED,<sp/>INCLUDING<sp/>WITHOUT<sp/>LIMITATION<sp/>ANY<sp/>IMPLIED</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="12"><highlight class="normal"></highlight><highlight class="comment">#<sp/>WARRANTIES<sp/>OR<sp/>CONDITIONS<sp/>OF<sp/>TITLE,<sp/>FITNESS<sp/>FOR<sp/>A<sp/>PARTICULAR<sp/>PURPOSE,</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="13"><highlight class="normal"></highlight><highlight class="comment">#<sp/>MERCHANTABLITY<sp/>OR<sp/>NON-INFRINGEMENT.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="14"><highlight class="normal"></highlight><highlight class="comment">#<sp/>See<sp/>the<sp/>Apache<sp/>2<sp/>License<sp/>for<sp/>the<sp/>specific<sp/>language<sp/>governing<sp/>permissions<sp/>and</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="15"><highlight class="normal"></highlight><highlight class="comment">#<sp/>limitations<sp/>under<sp/>the<sp/>License.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="16"><highlight class="normal"></highlight></codeline>
<codeline lineno="17"><highlight class="normal"></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/>numpy<sp/></highlight><highlight class="keyword">as</highlight><highlight class="normal"><sp/>np</highlight></codeline>
<codeline lineno="18"><highlight class="normal">np.set_printoptions(threshold=np.nan)</highlight></codeline>
<codeline lineno="19"><highlight class="normal">np.set_printoptions(linewidth=np.nan)</highlight></codeline>
<codeline lineno="20"><highlight class="normal"></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/>struct</highlight></codeline>
<codeline lineno="21"><highlight class="normal"></highlight></codeline>
<codeline lineno="22"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="23"><highlight class="normal"></highlight><highlight class="comment">##<sp/>Class<sp/>to<sp/>read<sp/>Kaldi<sp/>ark<sp/>format.<sp/>Each<sp/>time,<sp/>it<sp/>reads<sp/>one<sp/>line<sp/>of<sp/>the<sp/>.scp<sp/>file<sp/>and<sp/>reads<sp/>in<sp/>the<sp/>corresponding<sp/>features<sp/>into<sp/>a<sp/>numpy<sp/>matrix.<sp/>It<sp/>only<sp/>supports<sp/>binary-formatted<sp/>.ark<sp/>files.<sp/>Text<sp/>and<sp/>compressed<sp/>.ark<sp/>files<sp/>are<sp/>not<sp/>supported.<sp/>The<sp/>inspiration<sp/>for<sp/>this<sp/>class<sp/>came<sp/>from<sp/>pdnn<sp/>toolkit<sp/>(see<sp/>licence<sp/>at<sp/>the<sp/>top<sp/>of<sp/>this<sp/>file)(https://github.com/yajiemiao/pdnn)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="24" refid="classark_1_1ArkReader" refkind="compound"><highlight class="normal"></highlight><highlight class="keyword">class<sp/></highlight><highlight class="normal"><ref refid="classark_1_1ArkReader" kindref="compound">ArkReader</ref>(object):</highlight></codeline>
<codeline lineno="25"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="26"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">##ArkReader<sp/>constructor</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="27"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">#@param<sp/>scp_path<sp/>path<sp/>to<sp/>the<sp/>.scp<sp/>file</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="28"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">def<sp/></highlight><highlight class="normal"><ref refid="classark_1_1ArkReader_1a9b333d9c59866b69134a024632d6b1ae" kindref="member">__init__</ref>(self,<sp/>scp_path):</highlight></codeline>
<codeline lineno="29"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="30"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>self.<ref refid="classark_1_1ArkReader_1aaa3a3af73e31cae8619a4f9c8b119e6c" kindref="member">scp_position</ref><sp/>=<sp/>0</highlight></codeline>
<codeline lineno="31"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>fin<sp/>=<sp/>open(scp_path,</highlight><highlight class="stringliteral">&quot;</highlight><highlight class="stringliteral">r&quot;)</highlight></codeline>
<codeline lineno="32"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>self.<ref refid="classark_1_1ArkReader_1aaeaaec3d3e04d8d14071b980b804b130" kindref="member">utt_ids</ref><sp/>=<sp/>[]</highlight></codeline>
<codeline lineno="33"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>self.<ref refid="classark_1_1ArkReader_1ad35450c56a79a6c7a95db6fc13e3ddc8" kindref="member">scp_data</ref><sp/>=<sp/>[]</highlight></codeline>
<codeline lineno="34"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>line<sp/>=<sp/>fin.readline()</highlight></codeline>
<codeline lineno="35"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">while</highlight><highlight class="normal"><sp/>line<sp/>!=<sp/></highlight><highlight class="stringliteral">&apos;&apos;</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">and</highlight><highlight class="normal"><sp/>line<sp/>!=<sp/></highlight><highlight class="keywordtype">None</highlight><highlight class="normal">:</highlight></codeline>
<codeline lineno="36"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>utt_id,<sp/>path_pos<sp/>=<sp/>line.replace(</highlight><highlight class="stringliteral">&apos;\n&apos;</highlight><highlight class="normal">,</highlight><highlight class="stringliteral">&apos;&apos;</highlight><highlight class="normal">).<ref refid="classark_1_1ArkReader_1abca9f5851edb7e7a8eed29b0978b7f46" kindref="member">split</ref>(</highlight><highlight class="stringliteral">&apos;<sp/>&apos;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="37"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>path,<sp/>pos<sp/>=<sp/>path_pos.split(</highlight><highlight class="stringliteral">&apos;:&apos;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="38"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>self.utt_ids.append(utt_id)</highlight></codeline>
<codeline lineno="39"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>self.scp_data.append((path,<sp/>pos))</highlight></codeline>
<codeline lineno="40"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>line<sp/>=<sp/>fin.readline()</highlight></codeline>
<codeline lineno="41"><highlight class="normal"></highlight></codeline>
<codeline lineno="42"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>fin.close()</highlight></codeline>
<codeline lineno="43"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="44"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">##<sp/>read<sp/>data<sp/>from<sp/>the<sp/>archive</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="45"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">#@param<sp/>index<sp/>index<sp/>of<sp/>the<sp/>utterance<sp/>that<sp/>will<sp/>be<sp/>read</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="46"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">#@return<sp/>a<sp/>numpy<sp/>array<sp/>containing<sp/>the<sp/>data<sp/>from<sp/>the<sp/>utterance</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="47"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">def<sp/></highlight><highlight class="normal"><ref refid="classark_1_1ArkReader_1ad0a4a553d7e071b7ecc363f92c6f8659" kindref="member">read_utt_data</ref>(self,<sp/>index):</highlight></codeline>
<codeline lineno="48"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ark_read_buffer<sp/>=<sp/>open(self.<ref refid="classark_1_1ArkReader_1ad35450c56a79a6c7a95db6fc13e3ddc8" kindref="member">scp_data</ref>[index][0],<sp/></highlight><highlight class="stringliteral">&apos;rb&apos;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="49"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ark_read_buffer.seek(int(self.<ref refid="classark_1_1ArkReader_1ad35450c56a79a6c7a95db6fc13e3ddc8" kindref="member">scp_data</ref>[index][1]),0)</highlight></codeline>
<codeline lineno="50"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>header<sp/>=<sp/>struct.unpack(</highlight><highlight class="stringliteral">&apos;&lt;xcccc&apos;</highlight><highlight class="normal">,<sp/>ark_read_buffer.read(5))</highlight></codeline>
<codeline lineno="51"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>header[0]<sp/>!=<sp/></highlight><highlight class="stringliteral">&quot;B&quot;</highlight><highlight class="normal">:</highlight></codeline>
<codeline lineno="52"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">print</highlight><highlight class="normal"><sp/></highlight><highlight class="stringliteral">&quot;Input<sp/>.ark<sp/>file<sp/>is<sp/>not<sp/>binary&quot;</highlight><highlight class="normal">;<sp/>exit(1)</highlight></codeline>
<codeline lineno="53"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>header[1]<sp/>==<sp/></highlight><highlight class="stringliteral">&quot;C&quot;</highlight><highlight class="normal">:</highlight></codeline>
<codeline lineno="54"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">print</highlight><highlight class="normal"><sp/></highlight><highlight class="stringliteral">&quot;Input<sp/>.ark<sp/>file<sp/>is<sp/>compressed&quot;</highlight><highlight class="normal">;<sp/>exit(1)</highlight></codeline>
<codeline lineno="55"><highlight class="normal"></highlight></codeline>
<codeline lineno="56"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>rows<sp/>=<sp/>0;<sp/>cols=<sp/>0</highlight></codeline>
<codeline lineno="57"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>m,<sp/>rows<sp/>=<sp/>struct.unpack(</highlight><highlight class="stringliteral">&apos;&lt;bi&apos;</highlight><highlight class="normal">,<sp/>ark_read_buffer.read(5))</highlight></codeline>
<codeline lineno="58"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>n,<sp/>cols<sp/>=<sp/>struct.unpack(</highlight><highlight class="stringliteral">&apos;&lt;bi&apos;</highlight><highlight class="normal">,<sp/>ark_read_buffer.read(5))</highlight></codeline>
<codeline lineno="59"><highlight class="normal"></highlight></codeline>
<codeline lineno="60"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>tmp_mat<sp/>=<sp/>np.frombuffer(ark_read_buffer.read(rows<sp/>*<sp/>cols<sp/>*<sp/>4),<sp/>dtype=np.float32)</highlight></codeline>
<codeline lineno="61"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>utt_mat<sp/>=<sp/>np.reshape(tmp_mat,<sp/>(rows,<sp/>cols))</highlight></codeline>
<codeline lineno="62"><highlight class="normal"></highlight></codeline>
<codeline lineno="63"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ark_read_buffer.close()</highlight></codeline>
<codeline lineno="64"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="65"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>utt_mat</highlight></codeline>
<codeline lineno="66"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="67"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">##<sp/>read<sp/>the<sp/>next<sp/>utterance<sp/>in<sp/>the<sp/>scp<sp/>file</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="68"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">#@return<sp/>the<sp/>utterance<sp/>ID<sp/>of<sp/>the<sp/>utterance<sp/>that<sp/>was<sp/>read,<sp/>the<sp/>utterance<sp/>data,<sp/>bool<sp/>that<sp/>is<sp/>true<sp/>if<sp/>the<sp/>reader<sp/>looped<sp/>back<sp/>to<sp/>the<sp/>beginning</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="69"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">def<sp/></highlight><highlight class="normal"><ref refid="classark_1_1ArkReader_1a3acea90e00f29e30659b330d7d94bbc7" kindref="member">read_next_utt</ref>(self):</highlight></codeline>
<codeline lineno="70"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="71"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>len(self.<ref refid="classark_1_1ArkReader_1ad35450c56a79a6c7a95db6fc13e3ddc8" kindref="member">scp_data</ref>)<sp/>==<sp/>0:</highlight></codeline>
<codeline lineno="72"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">None</highlight><highlight class="normal"><sp/>,<sp/></highlight><highlight class="keywordtype">None</highlight><highlight class="normal">,<sp/></highlight><highlight class="keyword">True</highlight><highlight class="normal"><sp/></highlight></codeline>
<codeline lineno="73"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="74"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>self.<ref refid="classark_1_1ArkReader_1aaa3a3af73e31cae8619a4f9c8b119e6c" kindref="member">scp_position</ref><sp/>&gt;=<sp/>len(self.<ref refid="classark_1_1ArkReader_1ad35450c56a79a6c7a95db6fc13e3ddc8" kindref="member">scp_data</ref>):<sp/></highlight><highlight class="comment">#if<sp/>at<sp/>end<sp/>of<sp/>file<sp/>loop<sp/>around</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="75"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>looped<sp/>=<sp/></highlight><highlight class="keyword">True</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="76"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>self.<ref refid="classark_1_1ArkReader_1aaa3a3af73e31cae8619a4f9c8b119e6c" kindref="member">scp_position</ref><sp/>=<sp/>0</highlight></codeline>
<codeline lineno="77"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal">:<sp/></highlight></codeline>
<codeline lineno="78"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>looped<sp/>=<sp/></highlight><highlight class="keyword">False</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="79"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="80"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>self.<ref refid="classark_1_1ArkReader_1aaa3a3af73e31cae8619a4f9c8b119e6c" kindref="member">scp_position</ref><sp/>+=<sp/>1</highlight></codeline>
<codeline lineno="81"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="82"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>self.<ref refid="classark_1_1ArkReader_1aaeaaec3d3e04d8d14071b980b804b130" kindref="member">utt_ids</ref>[self.<ref refid="classark_1_1ArkReader_1aaa3a3af73e31cae8619a4f9c8b119e6c" kindref="member">scp_position</ref>-1],<sp/>self.<ref refid="classark_1_1ArkReader_1ad0a4a553d7e071b7ecc363f92c6f8659" kindref="member">read_utt_data</ref>(self.<ref refid="classark_1_1ArkReader_1aaa3a3af73e31cae8619a4f9c8b119e6c" kindref="member">scp_position</ref>-1),<sp/>looped</highlight></codeline>
<codeline lineno="83"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="84"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">##<sp/>read<sp/>the<sp/>next<sp/>utterance<sp/>ID<sp/>but<sp/>don&apos;t<sp/>read<sp/>the<sp/>data</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="85"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">#@return<sp/>the<sp/>utterance<sp/>ID<sp/>of<sp/>the<sp/>utterance<sp/>that<sp/>was<sp/>read</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="86"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">def<sp/></highlight><highlight class="normal"><ref refid="classark_1_1ArkReader_1a183e69aa240621eee9200f17783460e5" kindref="member">read_next_scp</ref>(self):</highlight></codeline>
<codeline lineno="87"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="88"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>self.<ref refid="classark_1_1ArkReader_1aaa3a3af73e31cae8619a4f9c8b119e6c" kindref="member">scp_position</ref><sp/>&gt;=<sp/>len(self.<ref refid="classark_1_1ArkReader_1ad35450c56a79a6c7a95db6fc13e3ddc8" kindref="member">scp_data</ref>):<sp/></highlight><highlight class="comment">#if<sp/>at<sp/>end<sp/>of<sp/>file<sp/>loop<sp/>around</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="89"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>self.<ref refid="classark_1_1ArkReader_1aaa3a3af73e31cae8619a4f9c8b119e6c" kindref="member">scp_position</ref><sp/>=<sp/>0</highlight></codeline>
<codeline lineno="90"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="91"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>self.<ref refid="classark_1_1ArkReader_1aaa3a3af73e31cae8619a4f9c8b119e6c" kindref="member">scp_position</ref><sp/>+=<sp/>1</highlight></codeline>
<codeline lineno="92"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="93"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>self.<ref refid="classark_1_1ArkReader_1aaeaaec3d3e04d8d14071b980b804b130" kindref="member">utt_ids</ref>[self.<ref refid="classark_1_1ArkReader_1aaa3a3af73e31cae8619a4f9c8b119e6c" kindref="member">scp_position</ref>-1]</highlight></codeline>
<codeline lineno="94"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="95"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">##<sp/>read<sp/>the<sp/>previous<sp/>utterance<sp/>ID<sp/>but<sp/>don&apos;t<sp/>read<sp/>the<sp/>data</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="96"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">#@return<sp/>the<sp/>utterance<sp/>ID<sp/>of<sp/>the<sp/>utterance<sp/>that<sp/>was<sp/>read</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="97"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">def<sp/></highlight><highlight class="normal"><ref refid="classark_1_1ArkReader_1ae0ec1f9846c6a4ae7221a80a345a2eaa" kindref="member">read_previous_scp</ref>(self):</highlight></codeline>
<codeline lineno="98"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="99"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>self.<ref refid="classark_1_1ArkReader_1aaa3a3af73e31cae8619a4f9c8b119e6c" kindref="member">scp_position</ref><sp/>&lt;<sp/>0:<sp/></highlight><highlight class="comment">#if<sp/>at<sp/>beginning<sp/>of<sp/>file<sp/>loop<sp/>around</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="100"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>self.<ref refid="classark_1_1ArkReader_1aaa3a3af73e31cae8619a4f9c8b119e6c" kindref="member">scp_position</ref><sp/>=<sp/>len(self.<ref refid="classark_1_1ArkReader_1ad35450c56a79a6c7a95db6fc13e3ddc8" kindref="member">scp_data</ref>)<sp/>-<sp/>1</highlight></codeline>
<codeline lineno="101"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="102"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>self.<ref refid="classark_1_1ArkReader_1aaa3a3af73e31cae8619a4f9c8b119e6c" kindref="member">scp_position</ref><sp/>-=<sp/>1</highlight></codeline>
<codeline lineno="103"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="104"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>self.<ref refid="classark_1_1ArkReader_1aaeaaec3d3e04d8d14071b980b804b130" kindref="member">utt_ids</ref>[self.<ref refid="classark_1_1ArkReader_1aaa3a3af73e31cae8619a4f9c8b119e6c" kindref="member">scp_position</ref>+1]</highlight></codeline>
<codeline lineno="105"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="106"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">##<sp/>read<sp/>the<sp/>data<sp/>of<sp/>a<sp/>certain<sp/>utterance<sp/>ID</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="107"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">#@return<sp/>the<sp/>utterance<sp/>data<sp/>corresponding<sp/>to<sp/>the<sp/>ID</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="108"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">def<sp/></highlight><highlight class="normal"><ref refid="classark_1_1ArkReader_1ad733f1cc66a886ef44bd14aaaede8dbd" kindref="member">read_utt</ref>(self,<sp/>utt_id):</highlight></codeline>
<codeline lineno="109"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="110"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>self.<ref refid="classark_1_1ArkReader_1ad0a4a553d7e071b7ecc363f92c6f8659" kindref="member">read_utt_data</ref>(self.utt_ids.index(utt_id))</highlight></codeline>
<codeline lineno="111"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="112"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">##Split<sp/>of<sp/>the<sp/>data<sp/>that<sp/>was<sp/>read<sp/>so<sp/>far</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="113"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">def<sp/></highlight><highlight class="normal"><ref refid="classark_1_1ArkReader_1abca9f5851edb7e7a8eed29b0978b7f46" kindref="member">split</ref>(self):</highlight></codeline>
<codeline lineno="114"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>self.<ref refid="classark_1_1ArkReader_1ad35450c56a79a6c7a95db6fc13e3ddc8" kindref="member">scp_data</ref><sp/>=<sp/>self.<ref refid="classark_1_1ArkReader_1ad35450c56a79a6c7a95db6fc13e3ddc8" kindref="member">scp_data</ref>[self.<ref refid="classark_1_1ArkReader_1aaa3a3af73e31cae8619a4f9c8b119e6c" kindref="member">scp_position</ref>:-1]</highlight></codeline>
<codeline lineno="115"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>self.<ref refid="classark_1_1ArkReader_1aaeaaec3d3e04d8d14071b980b804b130" kindref="member">utt_ids</ref><sp/>=<sp/>self.<ref refid="classark_1_1ArkReader_1aaeaaec3d3e04d8d14071b980b804b130" kindref="member">utt_ids</ref>[self.<ref refid="classark_1_1ArkReader_1aaa3a3af73e31cae8619a4f9c8b119e6c" kindref="member">scp_position</ref>:-1]</highlight></codeline>
<codeline lineno="116"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="117"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="118"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="119"><highlight class="normal"></highlight><highlight class="comment">##<sp/>Class<sp/>to<sp/>write<sp/>numpy<sp/>matrices<sp/>into<sp/>Kaldi<sp/>.ark<sp/>file<sp/>and<sp/>create<sp/>the<sp/>corresponding<sp/>.scp<sp/>file.<sp/>It<sp/>only<sp/>supports<sp/>binary-formatted<sp/>.ark<sp/>files.<sp/>Text<sp/>and<sp/>compressed<sp/>.ark<sp/>files<sp/>are<sp/>not<sp/>supported.<sp/>The<sp/>inspiration<sp/>for<sp/>this<sp/>class<sp/>came<sp/>from<sp/>pdnn<sp/>toolkit<sp/>(see<sp/>licence<sp/>at<sp/>the<sp/>top<sp/>of<sp/>this<sp/>file)(https://github.com/yajiemiao/pdnn)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="120" refid="classark_1_1ArkWriter" refkind="compound"><highlight class="normal"></highlight><highlight class="keyword">class<sp/></highlight><highlight class="normal"><ref refid="classark_1_1ArkWriter" kindref="compound">ArkWriter</ref>(object):</highlight></codeline>
<codeline lineno="121"><highlight class="normal"></highlight></codeline>
<codeline lineno="122"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">##Arkwriter<sp/>constructor</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="123"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">#@param<sp/>scp_path<sp/>path<sp/>to<sp/>the<sp/>.scp<sp/>file<sp/>that<sp/>will<sp/>be<sp/>written</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="124"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">def<sp/></highlight><highlight class="normal"><ref refid="classark_1_1ArkWriter_1aaae1f95df95645063a55420f7935a0f0" kindref="member">__init__</ref>(self,<sp/>scp_path):</highlight></codeline>
<codeline lineno="125"><highlight class="normal"></highlight></codeline>
<codeline lineno="126"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>self.<ref refid="classark_1_1ArkWriter_1a2fa74bfe94936763cca8cbdd9dee78c1" kindref="member">scp_path</ref><sp/>=<sp/>scp_path</highlight></codeline>
<codeline lineno="127"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>self.<ref refid="classark_1_1ArkWriter_1a8bda42e4b38eb15dd93a78edcb7c4116" kindref="member">scp_file_write</ref><sp/>=<sp/>open(self.<ref refid="classark_1_1ArkWriter_1a2fa74bfe94936763cca8cbdd9dee78c1" kindref="member">scp_path</ref>,</highlight><highlight class="stringliteral">&quot;w&quot;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="128"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="129"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">##read<sp/>an<sp/>utterance<sp/>to<sp/>the<sp/>archive</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="130"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">#@param<sp/>ark_path<sp/>path<sp/>to<sp/>the<sp/>.ark<sp/>file<sp/>that<sp/>will<sp/>be<sp/>used<sp/>for<sp/>writing</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="131"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">#@param<sp/>utt_id<sp/>the<sp/>utterance<sp/>ID</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="132"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">#@param<sp/>utt_mat<sp/>a<sp/>numpy<sp/>array<sp/>containing<sp/>the<sp/>utterance<sp/>data</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="133"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">def<sp/></highlight><highlight class="normal"><ref refid="classark_1_1ArkWriter_1a2baf126c5088d2bfa98a98a4688eb58e" kindref="member">write_next_utt</ref>(self,<sp/>ark_path,<sp/>utt_id,<sp/>utt_mat):</highlight></codeline>
<codeline lineno="134"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ark_file_write<sp/>=<sp/>open(ark_path,</highlight><highlight class="stringliteral">&quot;ab&quot;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="135"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>utt_mat<sp/>=<sp/>np.asarray(utt_mat,<sp/>dtype=np.float32)</highlight></codeline>
<codeline lineno="136"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>rows,<sp/>cols<sp/>=<sp/>utt_mat.shape</highlight></codeline>
<codeline lineno="137"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ark_file_write.write(struct.pack(</highlight><highlight class="stringliteral">&apos;&lt;%ds&apos;</highlight><highlight class="normal">%(len(utt_id)),<sp/>utt_id))</highlight></codeline>
<codeline lineno="138"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>pos<sp/>=<sp/>ark_file_write.tell()</highlight></codeline>
<codeline lineno="139"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ark_file_write.write(struct.pack(</highlight><highlight class="stringliteral">&apos;&lt;xcccc&apos;</highlight><highlight class="normal">,</highlight><highlight class="stringliteral">&apos;B&apos;</highlight><highlight class="normal">,</highlight><highlight class="stringliteral">&apos;F&apos;</highlight><highlight class="normal">,</highlight><highlight class="stringliteral">&apos;M&apos;</highlight><highlight class="normal">,</highlight><highlight class="stringliteral">&apos;<sp/>&apos;</highlight><highlight class="normal">))</highlight></codeline>
<codeline lineno="140"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ark_file_write.write(struct.pack(</highlight><highlight class="stringliteral">&apos;&lt;bi&apos;</highlight><highlight class="normal">,<sp/>4,<sp/>rows))</highlight></codeline>
<codeline lineno="141"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ark_file_write.write(struct.pack(</highlight><highlight class="stringliteral">&apos;&lt;bi&apos;</highlight><highlight class="normal">,<sp/>4,<sp/>cols))</highlight></codeline>
<codeline lineno="142"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ark_file_write.write(utt_mat)</highlight></codeline>
<codeline lineno="143"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>self.scp_file_write.write(</highlight><highlight class="stringliteral">&apos;%s<sp/>%s:%s\n&apos;</highlight><highlight class="normal"><sp/>%<sp/>(utt_id,<sp/>ark_path,<sp/>pos))</highlight></codeline>
<codeline lineno="144"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ark_file_write.close()</highlight></codeline>
<codeline lineno="145"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="146"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">##close<sp/>the<sp/>ark<sp/>writer</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="147"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">def<sp/></highlight><highlight class="normal"><ref refid="classark_1_1ArkWriter_1a8bf260f85283c505107867be3b46e483" kindref="member">close</ref>(self):</highlight></codeline>
<codeline lineno="148"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>self.scp_file_write.close()</highlight></codeline>
<codeline lineno="149"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight></codeline>
    </programlisting>
    <location file="/users/spraak/vrenkens/code/tfkaldi/io/ark.py"/>
  </compounddef>
</doxygen>
